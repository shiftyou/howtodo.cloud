---
layout: post
title:  "Helmìœ¼ë¡œ mysql ì„¤ì¹˜í•˜ê¸°"
categories: kubernetes
tags: helm
---
# Helm ì´ë€.

ê°œë°œê³¼ í…ŒìŠ¤íŠ¸ì˜ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ì‹œê°„ì„ ì¤„ì´ê³  í”„ë¡œê·¸ë¨ì— ì¢€ ë” ì§‘ì¤‘í•˜ê¸° ìœ„í•˜ì—¬ í•„ìš”í•œ ê²ƒì´ Helm ì´ë‹¤.   
node.jsì˜ npm ì´ë‚˜ ë¦¬ëˆ…ìŠ¤ì˜ yum, apt ê°™ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ íŒ¨í‚¤ì§€ ë©”ë‹ˆì €ë¼ê³  ë³´ë©´ ëœë‹¤.  
Chart, Repository, Releaseë¥¼ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µì ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ì„¤ì¹˜, êµ¬ì„± ë° ë²„ì ¼ê´€ë¦¬ ë°©ë²•ì„ ì œê³µí•œë‹¤.

- Chart : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‹¤í–‰ë˜ê³  ê²€ìƒ‰ ê°€ëŠ¥í•œ ë©”íƒ€ë°ì´í„°ë¡œ YAML íŒŒì¼ë¡œ ì •ì˜ëœ ì¿ ë²„ë„¤ì‹œí‹° ë¦¬ì†ŒìŠ¤ íŒ¨í‚¤ì§€
- Repository : ê²€ìƒ‰ê°€ëŠ¥í•œ Helm Chartì˜ ë¬¶ìŒ
- Release : ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ëœ Helm Chart ì¸ìŠ¤í„´ìŠ¤

ì•„í‚¤í…ì²˜ëŠ” ë‘ê°€ì§€ê°€ êµ¬ì„±ìš”ì†Œë¡œ ë˜ì–´ ìˆë‹¤.

![ì•„í‚¤í…ì²˜](https://cdn.app.compendium.com/uploads/user/e7c690e8-6ff9-102a-ac6d-e4aebca50425/5a29c3c1-7c6b-41fa-8082-bdc8a36177c9/Image/c64c01d08df64f4420e81f962fd13a23/screen_shot_2018_09_11_at_4_48_19_pm.png)

- The Tiller Server: ì¿ ë²„ë„¤í‹°ìŠ¤ APIì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” Helm ì„œë²„
- The Helm Client : ì»¤ë§¨ë“œ ë¼ì¸ Helm í´ë¼ì´ì–¸íŠ¸

# ì„¤ì¹˜

## The Tiller Server 
Oracle Container Engine for Kubernetes (OKE) ë¥¼ í†µí•´ì„œ ì¿ ë² ë„ˆí‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ Quick Createë¡œ ìƒì„±í•˜ë©´ ìë™ìœ¼ë¡œ Helm TillerëŠ” ì„¤ì¹˜ëœë‹¤. 

## The Helm Client
ì„¤ì¹˜ëŠ” ì—¬ëŸ¬ê°€ì§€ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.
- [Homebrew](https://brew.sh/) : brew install kubernetes-helm.
- [Chocolatey](https://chocolatey.org/) : choco install kubernetes-helm.
- [Scoop](https://scoop.sh/) : scoop install helm.
- [GoFish](https://gofi.sh/) : gofish install helm.


brew ë¡œ ì„¤ì¹˜ë¥¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
~~~sh
$ brew install kubernetes-helm

Updating Homebrew...
==> Auto-updated Homebrew!
Updated 1 tap (homebrew/core).
==> Downloading https://homebrew.bintray.com/bottles/kubernetes-helm-2.13.1.moja
==> Downloading from https://akamai.bintray.com/30/30f412ad5b85b63edbd373cfca01f
######################################################################## 100.0%
==> Pouring kubernetes-helm-2.13.1.mojave.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completions have been installed to:
  /usr/local/share/zsh/site-functions
==> Summary
ğŸº  /usr/local/Cellar/kubernetes-helm/2.13.1: 51 files, 84.2MB
==> `brew cleanup` has not been run in 30 days, running now...
$
 ~~~

# ì´ˆê¸°í™”

Helm ì´ ì¤€ë¹„ë˜ì—ˆìœ¼ë‹ˆ, ì´ˆê¸°í™”ë¥¼ í•œë‹¤.
~~~sh
$ helm init --history-max 200

$HELM_HOME has been configured at /Users/jonggyou/.helm.
Warning: Tiller is already installed in the cluster.
(Use --client-only to suppress this message, or --upgrade to upgrade Tiller to the current version.)
Happy Helming!
~~~

ìœ„ì˜ ëª…ë ¹ì–´ëŠ” ì›ë˜ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ `kubectl config current-context`ì— tillerë¥¼ ì„¤ì¹˜í•˜ëŠ” ê²ƒì´ë‚˜, OKEì—ì„œëŠ” ì´ë¯¸ ì„¤ì¹˜ê°€ ë˜ì–´ ìˆì–´ì„œ ì´ë¯¸ ì„¤ì¹˜ê°€ ë˜ì–´ ìˆë‹¤ê³  ì•Œë ¤ì¤€ë‹¤.

Tillerë¥¼ ì—…ê·¸ë ˆì´ë“œ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª…ë ¹í•œë‹¤.
~~~sh
$ helm init --upgrade

$HELM_HOME has been configured at /Users/jonggyou/.helm.

Tiller (the Helm server-side component) has been upgraded to the current version.
Happy Helming!
~~~

helmì˜ chartë¥¼ ìµœì‹  ë¦¬ìŠ¤íŠ¸ë¡œ ì—…ë°ì´íŠ¸ í•œë‹¤.
~~~sh
$ helm repo update

Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the "stable" chart repository
Update Complete. âˆ Happy Helming!âˆ
~~~

ì–´ë–¤ ì†”ë£¨ì…˜ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ”ì§€ëŠ” search ëª…ë ¹ì–´ë¡œ ì•Œ ìˆ˜ ìˆë‹¤.
~~~sh
$ helm search mysql

NAME                            	CHART VERSION	APP VERSION	DESCRIPTION
stable/mysql                    	0.15.0       	5.7.14     	Fast, reliable, scalable, and easy to use open-source rel...
stable/mysqldump                	2.4.0        	2.4.0      	A Helm chart to help backup MySQL databases using mysqldump
stable/prometheus-mysql-exporter	0.3.2        	v0.11.0    	A Helm chart for prometheus mysql exporter with cloudsqlp...
stable/percona                  	0.3.4        	5.7.17     	free, fully compatible, enhanced, open source drop-in rep...
stable/percona-xtradb-cluster   	0.6.6        	5.7.19     	free, fully compatible, enhanced, open source drop-in rep...
stable/phpmyadmin               	2.2.0        	4.8.5      	phpMyAdmin is an mysql administration frontend
stable/gcloud-sqlproxy          	0.6.1        	1.11       	DEPRECATED Google Cloud SQL Proxy
stable/mariadb                  	5.11.1       	10.1.38    	Fast, reliable, scalable, and easy to use open-source rel...

$ helm search tomcat

NAME         	CHART VERSION	APP VERSION	DESCRIPTION
stable/tomcat	0.2.0        	7          	Deploy a basic tomcat application server with sidecar as ...

$ helm search apache

NAME                	CHART VERSION	APP VERSION	DESCRIPTION
stable/hadoop       	1.1.0        	2.9.0      	The Apache Hadoop software library is a framework that al...
stable/ignite       	1.0.0        	2.7.0      	Apache Ignite is an open-source distributed database, cac...
stable/jenkins      	0.37.3       	lts        	Open source continuous integration server. It supports mu...
stable/kafka-manager	1.1.2        	1.3.3.22   	A tool for managing Apache Kafka.
stable/superset     	1.1.5        	0.28.1     	Apache Superset (incubating) is a modern, enterprise-read...
~~~

# ì„¤ì¹˜

mysqlì„ ì„¤ì¹˜í•´ ë³´ë„ë¡ í•œë‹¤.
~~~sh
$ helm install stable/mysql
~~~

ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ëœë‹¤.
~~~sh
NAME:   banking-squid
LAST DEPLOYED: Tue Apr 16 10:15:19 2019
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==> v1/ConfigMap
NAME                      DATA  AGE
banking-squid-mysql-test  1     3s

==> v1/PersistentVolumeClaim
NAME                 STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE
banking-squid-mysql  Pending  oci     3s

==> v1/Pod(related)
NAME                                 READY  STATUS   RESTARTS  AGE
banking-squid-mysql-685b45dfc-4dbkm  0/1    Pending  0         3s

==> v1/Secret
NAME                 TYPE    DATA  AGE
banking-squid-mysql  Opaque  2     4s

==> v1/Service
NAME                 TYPE       CLUSTER-IP    EXTERNAL-IP  PORT(S)   AGE
banking-squid-mysql  ClusterIP  10.96.194.55  <none>       3306/TCP  3s

==> v1beta1/Deployment
NAME                 READY  UP-TO-DATE  AVAILABLE  AGE
banking-squid-mysql  0/1    1           0          3s


NOTES:
MySQL can be accessed via port 3306 on the following DNS name from within your cluster:
banking-squid-mysql.default.svc.cluster.local

To get your root password run:

    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default banking-squid-mysql -o jsonpath="{.data.mysql-root-password}" | base64 --decode; echo)

To connect to your database:

1. Run an Ubuntu pod that you can use as a client:

    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il

2. Install the mysql client:

    $ apt-get update && apt-get install mysql-client -y

3. Connect using the mysql cli, then provide your password:
    $ mysql -h banking-squid-mysql -p

To connect to your database directly from outside the K8s cluster:
    MYSQL_HOST=127.0.0.1
    MYSQL_PORT=3306

    # Execute the following command to route the connection:
    kubectl port-forward svc/banking-squid-mysql 3306

    mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}

~~~

ê°™ì€ `helm install stable/mysql` ì„ ìˆ˜í–‰í•˜ë©´ ë‹¤ë¥¸ ì´ë¦„ì˜ mysqlì´ ë°°í¬ëœë‹¤. installì„ í•  ë•Œë§ˆë‹¤ ì´ë¦„ì´ ë‹¤ë¥´ê²Œ ë°°í¬ë˜ì–´ ì—¬ëŸ¬ë²ˆ ë°°í¬í•  ìˆ˜ ìˆë‹¤.

í˜„ì¬ helmìœ¼ë¡œ ë°°í¬ë˜ì–´ ìˆëŠ” í•­ëª©ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
~~~sh
$ helm ls

NAME         	REVISION	UPDATED                 	STATUS  	CHART       	APP VERSION	NAMESPACE
banking-squid	1       	Tue Apr 16 10:15:19 2019	DEPLOYED	mysql-0.15.0	5.7.14     	default
~~~

ë°°í¬ ë˜ì—ˆëŠ”ì§€ í™•ì¸ í•´ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
~~~sh
$ kubectl get all

NAME                                      READY     STATUS    RESTARTS   AGE
pod/banking-squid-mysql-685b45dfc-4dbkm   1/1       Running   0          1m

NAME                          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
service/banking-squid-mysql   ClusterIP   10.96.194.55   <none>        3306/TCP   1m
service/kubernetes            ClusterIP   10.96.0.1      <none>        443/TCP    11m

NAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/banking-squid-mysql   1         1         1            1           1m

NAME                                            DESIRED   CURRENT   READY     AGE
replicaset.apps/banking-squid-mysql-685b45dfc   1         1         1         1m
~~~
pod, service, deployment, replicaset ì´ ëª¨ë‘ ë“±ë¡ ë˜ì–´ ìˆë‹¤.

install í• ë•Œ ë‚˜ì˜¨ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ì„ í•´ ë³¸ë‹¤.
1. MYSQL_ROOT_PASSWORD ì–»ê¸°
    ~~~sh
    $ MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default banking-squid-mysql -o jsonpath="{.data.mysql-root-password}" | base64 --decode; echo)
    ~~~

    ì„¤ì •ë˜ì–´ìˆëŠ”ì§€ í™•ì¸ì„ í•´ ë³¸ë‹¤.
    ~~~sh
    $ echo $MYSQL_ROOT_PASSWORD
    EMum3INBxr
    ~~~

1. MYSQL í´ë¼ì´ì–¸íŠ¸ë¡œ ì‚¬ìš©í•  Ubuntu ë¦¬ëˆ…ìŠ¤ podì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•œë‹¤.
    ~~~sh
    $ kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il
    ~~~

    ìœ„ì˜ ëª…ë ¹ì–´ëŠ” ubuntu:16.04 ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ê³  bashë¥¼ ìˆ˜í–‰í•œ ê²ƒì´ë‹¤. ë‹¤ë¥¸ ì°½ì„ ì—´ì–´ì„œ í™•ì¸ í•´ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ pod ì´ ìƒì„±ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
    ~~~sh 
    $ kubectl get pods

    NAME                                      READY     STATUS    RESTARTS   AGE
    pod/banking-squid-mysql-685b45dfc-4dbkm   1/1       Running   0          58m
    pod/ubuntu                                1/1       Running   0          53s
    ~~~

    í˜¹ì‹œ í•´ë‹¹ podì„ ë¹ ì ¸ë‚˜ê°”ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰í•œë‹¤.
    ~~~sh
    $ kubectl exec -it ubuntu -- bash -il
    ~~~
    ì•ì˜ run ìœ¼ë¡œ ìˆ˜í–‰í•œ ê²ƒì€ imagesë¥¼ ê°€ì ¸ì™€ì„œ ìƒˆë¡œìš´ podì„ ë§Œë“œëŠ” ê²ƒì´ê³ ,  
    exec ë¡œ ìˆ˜í–‰í•œ ê²ƒì€ ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ podì— ì ‘ì†í•˜ëŠ” ê²ƒì´ë‹¤.

    í™”ë©´ì— ì‘ë‹µì´ ì—†ìœ¼ë©´ Enterë¥¼ ì³ë³¸ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡¬í”„íŠ¸ê°€ ëœ¬ë‹¤.
    ~~~sh
    root@ubuntu:/# 
    ~~~

1. mysql í´ë¼ì´ì–¸íŠ¸ë¥¼ ì„¤ì¹˜í•œë‹¤.

    
    ~~~sh
    root@ubuntu:/# apt-get update && apt-get install mysql-client -y
    ~~~

1. ë§ˆì§€ë§‰ìœ¼ë¡œ mysqlì— ì ‘ì†í•´ ë³¸ë‹¤.

    ~~~sh
    root@ubuntu:/# mysql -h banking-squid-mysql -p

    Enter password:
    Welcome to the MySQL monitor.  Commands end with ; or \g.
    Your MySQL connection id is 22152
    Server version: 5.7.14 MySQL Community Server (GPL)

    Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

    Oracle is a registered trademark of Oracle Corporation and/or its
    affiliates. Other names may be trademarks of their respective
    owners.

    Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

    mysql>
    ~~~
    íŒ¨ìŠ¤ì›Œë“œëŠ” ì´ì „ì— MYSQL_ROOT_PASSWORD í™˜ê²½ë³€ìˆ˜ë¡œ ê¸°ë¡ë˜ì–´ ìˆë‹¤.

1. ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì ‘ì†

    ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì ‘ì†í•˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ serviceì˜ í¬íŠ¸ë¥¼ í¬ì›Œë”© í•´ì¤€ë‹¤.  
    ìš°ì„  í™˜ê²½ë³€ìˆ˜ë¡œ ì‚¬ìš©í•  í•­ëª©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
    - MYSQL_HOST=127.0.0.1
    - MYSQL_PORT=3306

    í˜„ì¬ serviceëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
    ~~~sh
    $ kubectl get svc

    NAME                  TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
    banking-squid-mysql   ClusterIP   10.96.194.55   <none>        3306/TCP   1d
    kubernetes            ClusterIP   10.96.0.1      <none>        443/TCP    1d
    ~~~

    ê·¸ë¦¬ê³  í¬íŠ¸í¬ì›Œë”©ì€ ë‹¤ìŒê³¼ ê°™ì´ í•œë‹¤. 
    ~~~sh
    $ kubectl port-forward svc/banking-squid-mysql 3306

    Forwarding from 127.0.0.1:3306 -> 3306
    Forwarding from [::1]:3306 -> 3306
    ~~~

    ê·¸ í›„, ë¡œì»¬ ë¨¸ì‹ ì—ì„œ mysql clientë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤.
    ~~~sh
    $ mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}
    ~~~~

ì´ë¡œì¨ mysqlì„ kubernetesì— ì„¤ì¹˜í•˜ê³  ì ‘ì†ì´ ê°€ëŠ¥í•œ í™˜ê²½ì„ êµ¬ì„±í•˜ì˜€ë‹¤.

ì°¸ê³  :  
- [Take the Helm: Kubernetes Package Management](https://blogs.oracle.com/cloudnative/helm-kubernetes-package-management)
- [Creating a Cluster with Oracle Cloud Infrastructure Container Engine for Kubernetes](https://www.oracle.com/webfolder/technetwork/tutorials/obe/oci/oke-full/index.html)
- [Helm for Git](https://github.com/helm/helm)
- [Helm Quickstart Guide](https://helm.sh/docs/using_helm/#quickstart-guide)
